<div class="cards-page">
  <div class="page-header">
    <div class="header-text">
      <h1>Card Management</h1>
    </div>
    <div class="header-actions">
      <button class="secondary-btn" type="button">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        <span>Export</span>
      </button>
      <button class="primary-btn" type="button" (click)="openAddCard()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        <span>Add New Card</span>
      </button>
    </div>
  </div>

  <div class="table-card">
    <ng-container *ngIf="cards.length; else noCards">
      <table class="cards-table">
        <thead>
          <tr>
            <th>Card Type</th>
            <th>Card Numbers</th>
            <th>Site Name</th>
            <th>Status</th>
            <th class="actions-col"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let card of cards; index as i">
            <td>{{ card.cardType }}</td>
            <td>{{ card.cardNumber }}</td>
            <td>{{ card.siteName }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(card.status)">{{ card.status }}</span>
            </td>
            <td class="actions-cell">
              <div class="actions-wrapper">
                <button class="icon-btn" type="button" aria-label="Card actions" (click)="toggleMenu(i, $event)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                  </svg>
                </button>
                <div class="actions-menu" *ngIf="openMenuIndex === i">
                  <button type="button" class="menu-item" (click)="editCard(card, $event)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M17 3a2.828 2.828 0 0 1 4 4L7 21H3v-4L17 3z"></path>
                    </svg>
                    <span>Update</span>
                  </button>
                  <button type="button" class="menu-item danger" (click)="deleteCard(card, $event)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                      <path d="M10 11v6"></path>
                      <path d="M14 11v6"></path>
                      <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"></path>
                    </svg>
                    <span>Delete</span>
                  </button>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </ng-container>
    <ng-template #noCards>
      <div class="empty-state">No cards found.</div>
    </ng-template>
  </div>

  <div class="pagination">
    <button type="button" class="page-btn">&larr; Previous</button>
    <div class="page-numbers">
      <button type="button" class="page-number active">1</button>
      <button type="button" class="page-number">2</button>
      <button type="button" class="page-number">3</button>
      <span class="ellipsis">...</span>
      <button type="button" class="page-number">9</button>
      <button type="button" class="page-number">10</button>
    </div>
    <button type="button" class="page-btn">Next &rarr;</button>
  </div>

  <div class="drawer-overlay" *ngIf="showDrawer" (click)="closeAddCard()"></div>
  <div class="drawer" [class.open]="showDrawer" (click)="closeAddCard()">
    <form [formGroup]="addCardForm" (ngSubmit)="submitAddCard()" class="drawer-content" (click)="$event.stopPropagation()">
      <div class="drawer-header">
        <h2>{{ editingIndex !== null ? 'Update Card' : 'Add New Card' }}</h2>
        <button type="button" class="close-btn" (click)="closeAddCard()" aria-label="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="drawer-body">
        <div class="form-field" [class.invalid]="addCardForm.get('cardType')?.invalid && addCardForm.get('cardType')?.touched">
          <label>Card Type*</label>
          <select formControlName="cardType">
            <option [ngValue]="null" disabled>Please Select Type</option>
            <option *ngFor="let type of cardTypes" [ngValue]="type.value">{{ type.label }}</option>
          </select>
        </div>

        <div class="form-field" [class.invalid]="addCardForm.get('cardNumber')?.invalid && addCardForm.get('cardNumber')?.touched">
          <label>Card Numbers*</label>
          <input type="text" formControlName="cardNumber" placeholder="Enter card number" />
        </div>

        <div class="form-field" [class.invalid]="addCardForm.get('siteId')?.invalid && addCardForm.get('siteId')?.touched">
          <label>Site Name*</label>
          <select formControlName="siteId">
            <option [ngValue]="null" disabled>Please Select Type</option>
            <option *ngFor="let site of siteOptions" [ngValue]="site.id">{{ site.name }}</option>
          </select>
        </div>

        <div class="form-field" [class.invalid]="addCardForm.get('status')?.invalid && addCardForm.get('status')?.touched">
          <label>Status*</label>
          <select formControlName="status">
            <option [ngValue]="null" disabled>Please Select Type</option>
            <option *ngFor="let status of statusOptions" [ngValue]="status.value">{{ status.label }}</option>
          </select>
        </div>
      </div>

      <div class="drawer-footer">
        <button type="button" class="secondary-btn" (click)="closeAddCard()" [disabled]="isSaving">Cancel</button>
        <button type="submit" class="primary-btn" [disabled]="isSaving">
          <span *ngIf="!isSaving">{{ editingIndex !== null ? 'Update' : 'Save' }}</span>
          <span *ngIf="isSaving">Saving...</span>
        </button>
      </div>
    </form>
  </div>
</div>
