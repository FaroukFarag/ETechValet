<div class="pricing-page">
  <div class="page-header">
    <div class="header-text">
      <h1>Pricing Management</h1>
    </div>
    <div class="header-actions">
      <button class="secondary-btn" type="button">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        <span>Export</span>
      </button>
      <button class="primary-btn" type="button" (click)="openDrawer()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        <span>Add Gate Pricing</span>
      </button>
    </div>
  </div>

  <div class="filters-bar">
    <div class="tabs">
      <button
        *ngFor="let tab of tabs"
        class="tab-btn"
        type="button"
        [class.active]="tab === activeTab"
        (click)="setActiveTab(tab)">
        {{ tab }}
      </button>
    </div>

    <div class="filter-dropdown">
      <button class="filter-btn" type="button" (click)="toggleFilterDropdown($event)">
        <span>{{ activeFilter === 'All' ? 'Filter By' : activeFilter }}</span>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </button>
      <div class="filter-menu" *ngIf="filterDropdownOpen">
        <button type="button" (click)="selectFilter('All', $event)">All</button>
        <button type="button" (click)="selectFilter('Valet', $event)">Valet</button>
        <button type="button" (click)="selectFilter('Parking', $event)">Parking</button>
      </div>
    </div>
  </div>

  <div class="table-card">
    <table class="pricing-table">
      <thead>
        <tr>
          <th>Gate Name</th>
          <th>Site Name</th>
          <th>Valet Pricing Type</th>
          <th>Daily Rate</th>
          <th>Hourly Rate</th>
          <th>Max Daily Rate</th>
          <th>Free Hours</th>
          <th>Calendar Based Pricing</th>
          <th class="actions-col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of filteredPricingData; index as i">
          <td>{{ row.gateName }}</td>
          <td>{{ row.siteName }}</td>
          <td>{{ row.valetPricingType }}</td>
          <td>{{ row.dailyRate }}</td>
          <td>{{ row.hourlyRate }}</td>
          <td>{{ row.maxDailyRate }}</td>
          <td>{{ row.freeHours }}</td>
          <td>
            <label class="switch">
              <input type="checkbox" [checked]="row.calendarBasedPricing" (click)="toggleCalendarPricing(row, $event)" />
              <span class="slider"></span>
            </label>
          </td>
          <td class="actions-cell">
            <div class="actions-wrapper">
              <button class="icon-btn" type="button" aria-label="Pricing actions" (click)="toggleRowMenu(i, $event)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="5" r="1"></circle>
                  <circle cx="12" cy="12" r="1"></circle>
                  <circle cx="12" cy="19" r="1"></circle>
                </svg>
              </button>
              <div class="actions-menu" *ngIf="openMenuIndex === i">
                <button type="button" class="menu-item" (click)="editPricing(row, $event)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 3a2.828 2.828 0 0 1 4 4L7 21H3v-4L17 3z"></path>
                  </svg>
                  <span>Update</span>
                </button>
                <button type="button" class="menu-item danger" (click)="deletePricing(row, $event)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                    <path d="M10 11v6"></path>
                    <path d="M14 11v6"></path>
                    <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"></path>
                  </svg>
                  <span>Delete</span>
                </button>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <button type="button" class="page-btn">&larr; Previous</button>
    <div class="page-numbers">
      <button type="button" class="page-number active">1</button>
      <button type="button" class="page-number">2</button>
      <button type="button" class="page-number">3</button>
      <span class="ellipsis">...</span>
      <button type="button" class="page-number">9</button>
      <button type="button" class="page-number">10</button>
    </div>
    <button type="button" class="page-btn">Next &rarr;</button>
  </div>

  <div class="drawer-overlay" *ngIf="showDrawer" (click)="closeDrawer()"></div>
  <div class="drawer" [class.open]="showDrawer" (click)="closeDrawer()">
    <form [formGroup]="pricingForm" (ngSubmit)="submitPricing()" class="drawer-content" (click)="$event.stopPropagation()">
      <div class="drawer-header">
        <h2>New Gate Pricing</h2>
        <button type="button" class="close-btn" (click)="closeDrawer()" aria-label="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="drawer-tabs">
        <button type="button" [class.active]="pricingFormTab === 'Guest Pricing'" (click)="pricingFormTab = 'Guest Pricing'">Guest Pricing</button>
        <button type="button" [class.active]="pricingFormTab === 'Visitor Pricing'" (click)="pricingFormTab = 'Visitor Pricing'">Visitor Pricing</button>
      </div>

      <div class="drawer-body">
        <div class="form-field" [class.invalid]="pricingForm.get('gateName')?.invalid && pricingForm.get('gateName')?.touched">
          <label>Gate Name*</label>
          <select formControlName="gateName">
            <option value="" disabled>Select Gate</option>
            <option *ngFor="let gate of gateOptions" [value]="gate">{{ gate }}</option>
          </select>
        </div>

        <div class="form-field" [class.invalid]="pricingForm.get('siteName')?.invalid && pricingForm.get('siteName')?.touched">
          <label>Site Name*</label>
          <select formControlName="siteName">
            <option value="" disabled>Select Site</option>
            <option *ngFor="let site of siteOptions" [value]="site">{{ site }}</option>
          </select>
        </div>

        <div class="section">
          <div class="section-header">
            <span>Valet {{ pricingFormTab === 'Guest Pricing' ? 'Guest' : 'Visitor' }} Pricing</span>
            <label class="switch">
              <input type="checkbox" formControlName="valetGuestPricingEnabled" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="form-field" [class.invalid]="pricingForm.get('valetGuestPricingType')?.invalid && pricingForm.get('valetGuestPricingType')?.touched">
            <label>Pricing Type*</label>
            <select formControlName="valetGuestPricingType">
              <option value="" disabled>Select Type</option>
              <option *ngFor="let type of valetPricingTypes" [value]="type.value">{{ type.label }}</option>
            </select>
          </div>

          <div class="form-field" [class.invalid]="pricingForm.get('valetGuestDailyRate')?.invalid && pricingForm.get('valetGuestDailyRate')?.touched">
            <label>Daily Rate*</label>
            <div class="input-with-addon">
              <input type="text" formControlName="valetGuestDailyRate" placeholder="Enter amount" />
              <span class="addon">SAR</span>
            </div>
          </div>

          <div class="form-field" [class.invalid]="pricingForm.get('valetGuestFreeHours')?.invalid && pricingForm.get('valetGuestFreeHours')?.touched">
            <label>Free Hours*</label>
            <input type="text" formControlName="valetGuestFreeHours" placeholder="30 Minutes" />
          </div>
        </div>

        <div class="section">
          <div class="section-header">
            <span>Enable Parking {{ pricingFormTab === 'Guest Pricing' ? 'Guest' : 'Visitor' }} Pricing</span>
            <label class="switch">
              <input type="checkbox" formControlName="parkingGuestPricingEnabled" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="form-field" [class.invalid]="pricingForm.get('parkingGuestPricingType')?.invalid && pricingForm.get('parkingGuestPricingType')?.touched">
            <label>Pricing Type*</label>
            <select formControlName="parkingGuestPricingType">
              <option value="" disabled>Select Type</option>
              <option *ngFor="let type of valetPricingTypes" [value]="type.value">{{ type.label }}</option>
            </select>
          </div>

          <div class="form-field" [class.invalid]="pricingForm.get('parkingGuestDailyRate')?.invalid && pricingForm.get('parkingGuestDailyRate')?.touched">
            <label>Daily Rate*</label>
            <div class="input-with-addon">
              <input type="text" formControlName="parkingGuestDailyRate" placeholder="Enter amount" />
              <span class="addon">SAR</span>
            </div>
          </div>

          <div class="form-field" [class.invalid]="pricingForm.get('parkingGuestFreeHours')?.invalid && pricingForm.get('parkingGuestFreeHours')?.touched">
            <label>Free Hours*</label>
            <input type="text" formControlName="parkingGuestFreeHours" placeholder="30 Minutes" />
          </div>
        </div>

        <div class="section">
          <div class="section-header">
            <span>Calendar-Based Pricing</span>
            <label class="switch">
              <input type="checkbox" formControlName="calendarPricingEnabled" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="calendar-grid" *ngIf="pricingForm.value.calendarPricingEnabled">
            <div class="form-field">
              <label>Start Date</label>
              <input type="date" formControlName="calendarPricingStartDate" />
            </div>
            <div class="form-field">
              <label>End Date</label>
              <input type="date" formControlName="calendarPricingEndDate" />
            </div>
            <div class="form-field">
              <label>Pricing Type*</label>
              <select formControlName="calendarPricingType">
                <option value="" disabled>Select Type</option>
                <option *ngFor="let type of valetPricingTypes" [value]="type.value">{{ type.label }}</option>
              </select>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-header">
            <span>Weekday-Based Pricing</span>
            <label class="switch">
              <input type="checkbox" formControlName="weekdayPricingEnabled" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="weekday-grid" *ngIf="pricingForm.value.weekdayPricingEnabled">
            <button
              type="button"
              class="weekday-chip"
              *ngFor="let day of weekdayOptions"
              [class.selected]="(pricingForm.value.weekdayPricingDays ?? []).includes(day)"
              (click)="selectWeekday(day)">
              {{ day }}
            </button>

            <div class="form-field">
              <label>Pricing Type*</label>
              <select formControlName="weekdayPricingType">
                <option value="" disabled>Select Type</option>
                <option *ngFor="let type of valetPricingTypes" [value]="type.value">{{ type.label }}</option>
              </select>
            </div>

            <div class="form-field">
              <label>Repeat This Pricing</label>
              <select formControlName="repeatPricing">
                <option value="" disabled>Select Type</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <div class="drawer-footer">
        <button type="button" class="secondary-btn" (click)="closeDrawer()">Cancel</button>
        <button type="submit" class="primary-btn">Save</button>
      </div>
    </form>
  </div>
</div>
