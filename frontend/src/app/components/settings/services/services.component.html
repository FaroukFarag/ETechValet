<div class="services-page">
  <div class="page-header">
    <div class="header-text">
      <h1>Service Management</h1>
    </div>
    <div class="header-actions">
      <button class="secondary-btn" type="button">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        <span>Export</span>
      </button>
      <button class="primary-btn" type="button" (click)="openAddService()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        <span>Add New Service</span>
      </button>
    </div>
  </div>

  <ng-container *ngIf="!isLoading && !loadError && services.length > 0; else servicesState">
    <div class="table-card">
      <table class="services-table">
        <thead>
          <tr>
            <th>Service Name</th>
            <th>Description</th>
            <th>Status</th>
            <th class="actions-col"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let service of services; index as i">
            <td>{{ service.name }}</td>
            <td class="description">{{ service.description }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(service.status)">{{ service.status }}</span>
            </td>
            <td class="actions-cell">
              <div class="actions-wrapper">
                <button class="icon-btn" type="button" aria-label="Service actions" (click)="toggleMenu(i, $event)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                  </svg>
                </button>
                <div class="actions-menu" *ngIf="openMenuIndex === i">
                  <button type="button" class="menu-item" (click)="editService(service, $event)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M17 3a2.828 2.828 0 0 1 4 4L7 21H3v-4L17 3z"></path>
                    </svg>
                    <span>Update</span>
                  </button>
                  <button type="button" class="menu-item danger" (click)="deleteService(service, $event)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                      <path d="M10 11v6"></path>
                      <path d="M14 11v6"></path>
                      <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"></path>
                    </svg>
                    <span>Delete</span>
                  </button>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination">
      <button type="button" class="page-btn">&larr; Previous</button>
      <div class="page-numbers">
        <button type="button" class="page-number active">1</button>
        <button type="button" class="page-number">2</button>
        <button type="button" class="page-number">3</button>
        <span class="ellipsis">...</span>
        <button type="button" class="page-number">9</button>
        <button type="button" class="page-number">10</button>
      </div>
      <button type="button" class="page-btn">Next &rarr;</button>
    </div>
  </ng-container>

  <ng-template #servicesState>
    <div class="table-card status-card">
      <div *ngIf="isLoading" class="status-content">
        <div class="spinner"></div>
        <p>Loading services...</p>
      </div>
      <div *ngIf="!isLoading && loadError" class="status-content">
        <p>{{ loadError }}</p>
        <button type="button" class="secondary-btn" (click)="fetchServices()">Retry</button>
      </div>
      <div *ngIf="!isLoading && !loadError && services.length === 0" class="status-content">
        <p>No services available yet.</p>
        <button type="button" class="primary-btn" (click)="openAddService()">Add New Service</button>
      </div>
    </div>
  </ng-template>

  <div class="drawer-overlay" *ngIf="showDrawer" (click)="closeDrawer()"></div>
  <div class="drawer" [class.open]="showDrawer" (click)="closeDrawer()">
    <form [formGroup]="serviceForm" (ngSubmit)="submitService()" class="drawer-content" (click)="$event.stopPropagation()">
      <div class="drawer-header">
        <h2>{{ editingService ? 'Update Service' : 'Add New Service' }}</h2>
        <button type="button" class="close-btn" (click)="closeDrawer()" aria-label="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="drawer-body">
        <div class="form-field" [class.invalid]="serviceForm.get('name')?.invalid && serviceForm.get('name')?.touched">
          <label>Service Name*</label>
          <input type="text" formControlName="name" placeholder="Enter service name" />
        </div>

        <div class="form-field" [class.invalid]="serviceForm.get('description')?.invalid && serviceForm.get('description')?.touched">
          <label>Description*</label>
          <textarea formControlName="description" rows="3" placeholder="Describe the service"></textarea>
        </div>

        <div class="form-field" [class.invalid]="serviceForm.get('status')?.invalid && serviceForm.get('status')?.touched">
          <label>Status*</label>
          <select formControlName="status">
            <option [ngValue]="null" disabled>Please Select Type</option>
            <option *ngFor="let option of statusOptions" [ngValue]="option.value">{{ option.label }}</option>
          </select>
        </div>
      </div>

      <div class="drawer-footer">
        <button type="button" class="secondary-btn" (click)="closeDrawer()" [disabled]="isSaving">Cancel</button>
        <button type="submit" class="primary-btn" [disabled]="isSaving">
          <span *ngIf="!isSaving">{{ editingService ? 'Update' : 'Save' }}</span>
          <span *ngIf="isSaving">Saving...</span>
        </button>
      </div>
    </form>
  </div>

  <div class="confirm-overlay" *ngIf="showDeleteConfirm" (click)="cancelDelete()"></div>
  <div class="confirm-dialog" *ngIf="showDeleteConfirm" (click)="$event.stopPropagation()">
    <h3>Delete Service</h3>
    <p>Are you sure you want to delete this service? This action cannot be undone.</p>
    <div class="confirm-actions">
      <button type="button" class="secondary-btn" (click)="cancelDelete()">Cancel</button>
      <button type="button" class="danger-btn" (click)="confirmDelete()">Delete</button>
    </div>
  </div>
</div>
